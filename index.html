<!DOCTYPE html>
<html>
<head>
    <title>Shipment Data Viewer - GitHub Pages Edition</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f0f2f5;
            color: #1a1a1a;
        }
        
        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            color: white;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        .navigation {
            background: white;
            padding: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .nav-buttons {
            display: flex;
            gap: 10px;
        }
        
        .nav-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .nav-btn:hover {
            background: #2980b9;
            transform: translateY(-1px);
        }
        
        .nav-btn:disabled {
            background: #95a5a6;
            cursor: not-allowed;
            transform: none;
        }
        
        .content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .loading {
            text-align: center;
            padding: 50px;
            font-size: 18px;
            color: #7f8c8d;
        }
        
        .error {
            background: #e74c3c;
            color: white;
            padding: 20px;
            border-radius: 5px;
            margin: 20px;
            text-align: center;
        }
        
        .shipment-content {
            display: none;
        }
        
        .shipment-content.active {
            display: block;
            animation: fadeIn 0.3s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .stat-box {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .stat-value {
            font-size: 36px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 14px;
            opacity: 0.9;
        }
        
        .overview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .overview-card {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .overview-card h3 {
            margin-bottom: 20px;
            color: #2c3e50;
            font-size: 20px;
            border-bottom: 2px solid #ecf0f1;
            padding-bottom: 10px;
        }
        
        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #ecf0f1;
        }
        
        .info-row:last-child {
            border-bottom: none;
        }
        
        .info-label {
            font-weight: 600;
            color: #7f8c8d;
        }
        
        .info-value {
            color: #2c3e50;
            text-align: right;
            max-width: 60%;
            word-break: break-word;
        }
        
        .timeline {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            margin-bottom: 20px;
        }
        
        .timeline h3 {
            margin-bottom: 20px;
            color: #2c3e50;
            font-size: 20px;
        }
        
        .timeline-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: 20px;
            padding-left: 30px;
            position: relative;
        }
        
        .timeline-item::before {
            content: '';
            position: absolute;
            left: 8px;
            top: 8px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }
        
        .timeline-item::after {
            content: '';
            position: absolute;
            left: 13px;
            top: 20px;
            width: 2px;
            height: calc(100% + 10px);
            background: #ecf0f1;
        }
        
        .timeline-item:last-child::after {
            display: none;
        }
        
        .timeline-date {
            min-width: 180px;
            font-weight: 600;
            color: #7f8c8d;
            font-size: 14px;
        }
        
        .timeline-content {
            flex: 1;
            padding-left: 20px;
        }
        
        .timeline-title {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 5px;
        }
        
        .timeline-description {
            color: #7f8c8d;
            font-size: 14px;
            line-height: 1.6;
        }
        
        .tab-container {
            margin-bottom: 20px;
        }
        
        .tab-buttons {
            display: flex;
            gap: 5px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .tab-btn {
            background: #ecf0f1;
            border: none;
            padding: 10px 20px;
            border-radius: 5px 5px 0 0;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
            color: #2c3e50;
        }
        
        .tab-btn:hover {
            background: #bdc3c7;
        }
        
        .tab-btn.active {
            background: #3498db;
            color: white;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .detail-section {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .detail-section h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #ecf0f1;
            font-size: 20px;
        }
        
        .detail-section h3 {
            color: #2c3e50;
            margin-top: 20px;
            margin-bottom: 15px;
            font-size: 16px;
        }
        
        .raw-data {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .raw-data h3 {
            margin-bottom: 20px;
            color: #2c3e50;
            font-size: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .copy-btn {
            background: #27ae60;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .copy-btn:hover {
            background: #229954;
        }
        
        .copy-btn.copied {
            background: #2ecc71;
        }
        
        pre {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 5px;
            overflow-x: auto;
            font-size: 13px;
            line-height: 1.6;
            border: 1px solid #ecf0f1;
        }
        
        .search-box {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-left: auto;
        }
        
        .search-input {
            padding: 8px 15px;
            border: 1px solid #ecf0f1;
            border-radius: 5px;
            font-size: 14px;
            width: 200px;
        }
        
        .chunk-info {
            color: #7f8c8d;
            font-size: 12px;
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üì¶ Enhanced Shipment Viewer</h1>
        <p>Comprehensive shipment tracking and analysis</p>
    </div>
    
    <div class="navigation">
        <div class="nav-buttons">
            <button class="nav-btn" id="prevBtn" onclick="navigateShipment(-1)">‚¨ÖÔ∏è Previous</button>
            <span id="shipmentCounter" style="padding: 0 20px; font-weight: 600;">Loading...</span>
            <button class="nav-btn" id="nextBtn" onclick="navigateShipment(1)">Next ‚û°Ô∏è</button>
        </div>
        <div class="search-box">
            <input type="text" class="search-input" id="searchInput" placeholder="Search shipment ID...">
            <button class="nav-btn" onclick="searchShipment()">Search</button>
            <span class="chunk-info" id="chunkInfo"></span>
        </div>
    </div>
    
    <div class="content" id="content">
        <div class="loading" id="loadingMessage">Loading shipment data...</div>
    </div>

    <script>
        let dataIndex = null;
        let currentChunkData = {};
        let currentShipmentIndex = 0;
        let currentChunkId = -1;
        let allShipmentIds = [];

        // Load data index on startup
        async function loadDataIndex() {
            try {
                console.log('Loading data index...');
                const response = await fetch('data_index.json');
                if (!response.ok) throw new Error('Failed to load data index');
                dataIndex = await response.json();
                console.log('Data index loaded, total shipments:', dataIndex.total_shipments);
                
                // Load first chunk
                await loadChunk(0);
                console.log('First chunk loaded, shipment IDs:', allShipmentIds.length);
                
                // Display the first shipment
                if (allShipmentIds.length > 0) {
                    const firstShipmentId = allShipmentIds[0];
                    displayShipment(firstShipmentId, currentChunkData[firstShipmentId]);
                    updateNavigation();
                }
                
                // Update UI
                document.getElementById('loadingMessage').style.display = 'none';
                updateChunkInfo();
            } catch (error) {
                console.error('Failed to load data index:', error);
                showError('Failed to load data index: ' + error.message);
            }
        }

        // Load a specific chunk
        async function loadChunk(chunkId) {
            if (chunkId === currentChunkId) return; // Already loaded
            
            try {
                const chunkInfo = dataIndex.chunks[chunkId];
                console.log('Loading chunk:', chunkId, 'filename:', chunkInfo.filename);
                const response = await fetch(chunkInfo.filename);
                if (!response.ok) throw new Error(`Failed to load chunk: ${response.status} ${response.statusText}`);
                
                currentChunkData = await response.json();
                currentChunkId = chunkId;
                
                // Update shipment IDs list for this chunk
                updateShipmentIdsList();
                console.log('Chunk loaded successfully, shipments in chunk:', Object.keys(currentChunkData).length);
                
            } catch (error) {
                console.error('Failed to load data chunk:', error);
                showError('Failed to load data chunk: ' + error.message);
            }
        }

        // Update list of shipment IDs in current chunk
        function updateShipmentIdsList() {
            allShipmentIds = Object.keys(currentChunkData);
        }

        // Get chunk ID for a given global shipment index
        function getChunkForIndex(globalIndex) {
            return Math.floor(globalIndex / dataIndex.chunks_per_file);
        }

        // Navigate between shipments
        async function navigateShipment(direction) {
            const newIndex = currentShipmentIndex + direction;
            
            if (newIndex < 0 || newIndex >= dataIndex.total_shipments) return;
            
            currentShipmentIndex = newIndex;
            
            // Check if we need to load a new chunk
            const requiredChunk = getChunkForIndex(currentShipmentIndex);
            if (requiredChunk !== currentChunkId) {
                await loadChunk(requiredChunk);
            }
            
            // Display the shipment
            const localIndex = currentShipmentIndex % dataIndex.chunks_per_file;
            const shipmentId = allShipmentIds[localIndex];
            displayShipment(shipmentId, currentChunkData[shipmentId]);
            
            updateNavigation();
            updateChunkInfo();
        }

        // Search for shipment
        async function searchShipment() {
            const searchId = document.getElementById('searchInput').value.trim();
            if (!searchId) return;
            
            // Search through all chunks
            for (let i = 0; i < dataIndex.chunks.length; i++) {
                const chunkInfo = dataIndex.chunks[i];
                
                // Load chunk if not current
                if (i !== currentChunkId) {
                    await loadChunk(i);
                }
                
                if (searchId in currentChunkData) {
                    // Found it!
                    currentShipmentIndex = chunkInfo.start_index + allShipmentIds.indexOf(searchId);
                    displayShipment(searchId, currentChunkData[searchId]);
                    updateNavigation();
                    updateChunkInfo();
                    return;
                }
            }
            
            alert('Shipment ID not found');
        }

        // Update navigation buttons
        function updateNavigation() {
            document.getElementById('prevBtn').disabled = currentShipmentIndex === 0;
            document.getElementById('nextBtn').disabled = currentShipmentIndex >= dataIndex.total_shipments - 1;
            document.getElementById('shipmentCounter').textContent = 
                `Shipment ${currentShipmentIndex + 1} of ${dataIndex.total_shipments}`;
        }

        // Update chunk info
        function updateChunkInfo() {
            document.getElementById('chunkInfo').textContent = 
                `(Chunk ${currentChunkId + 1}/${dataIndex.total_chunks})`;
        }

        // Display shipment data
        function displayShipment(shipmentId, data) {
            const content = document.getElementById('content');
            
            // Parse the data - using the actual structure
            const milestones = data.milestones || [];
            const duration = data.total_shipment_duration || 0;
            const logCount = data.log_entries_count || 0;
            const documents = milestones.filter(m => m.event?.toLowerCase().includes('document')).length;
            
            // Generate HTML
            const html = `
                <div id="shipment-0" class="shipment-content active">
                    <!-- Quick Stats -->
                    <div class="stats-grid">
                        <div class="stat-box">
                            <div class="stat-value">${logCount}</div>
                            <div class="stat-label">Log Entries</div>
                        </div>
                        <div class="stat-box" style="background: linear-gradient(135deg, #27ae60 0%, #229954 100%);">
                            <div class="stat-value">${duration}</div>
                            <div class="stat-label">Days Duration</div>
                        </div>
                        <div class="stat-box" style="background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);">
                            <div class="stat-value">${milestones.length}</div>
                            <div class="stat-label">Key Milestones</div>
                        </div>
                        <div class="stat-box" style="background: linear-gradient(135deg, #f39c12 0%, #d68910 100%);">
                            <div class="stat-value">${documents}</div>
                            <div class="stat-label">Documents</div>
                        </div>
                    </div>
                    
                    <!-- Tab Navigation -->
                    <div class="tab-container">
                        <div class="tab-buttons">
                            <button class="tab-btn active" onclick="showTab(0, 'overview')">Overview</button>
                            <button class="tab-btn" onclick="showTab(0, 'milestones')">Milestones</button>
                            <button class="tab-btn" onclick="showTab(0, 'pricing')">Pricing</button>
                            <button class="tab-btn" onclick="showTab(0, 'providers')">Providers</button>
                            <button class="tab-btn" onclick="showTab(0, 'geographic')">Geographic</button>
                            <button class="tab-btn" onclick="showTab(0, 'documents')">Documents</button>
                            <button class="tab-btn" onclick="showTab(0, 'financial')">Financial</button>
                            <button class="tab-btn" onclick="showTab(0, 'system')">System</button>
                            <button class="tab-btn" onclick="showTab(0, 'rates')">Rates</button>
                            <button class="tab-btn" onclick="showTab(0, 'timestamps')">Timestamps</button>
                            <button class="tab-btn" onclick="showTab(0, 'entities')">Entities</button>
                        </div>
                        
                        <!-- Overview Tab (default active) -->
                        <div id="tab-0-overview" class="tab-content active">
                            <div class="overview-grid">
                                ${generateOverviewCards(data, shipmentId)}
                            </div>
                        </div>
                        
                        <!-- Milestones Tab -->
                        <div id="tab-0-milestones" class="tab-content">
                            <div class="timeline">
                                <h3>üìÖ Shipment Timeline</h3>
                                ${generateTimeline(milestones)}
                            </div>
                        </div>
                        
                        <!-- Pricing Tab -->
                        <div id="tab-0-pricing" class="tab-content">
                            ${generatePricingTab(data)}
                        </div>
                        
                        <!-- Providers Tab -->
                        <div id="tab-0-providers" class="tab-content">
                            ${generateProvidersTab(data)}
                        </div>
                        
                        <!-- Geographic Tab -->
                        <div id="tab-0-geographic" class="tab-content">
                            ${generateGeographicTab(data)}
                        </div>
                        
                        <!-- Documents Tab -->
                        <div id="tab-0-documents" class="tab-content">
                            ${generateDocumentsTab(data)}
                        </div>
                        
                        <!-- Financial Tab -->
                        <div id="tab-0-financial" class="tab-content">
                            ${generateFinancialTab(data)}
                        </div>
                        
                        <!-- System Tab -->
                        <div id="tab-0-system" class="tab-content">
                            ${generateSystemTab(data)}
                        </div>
                        
                        <!-- Rates Tab -->
                        <div id="tab-0-rates" class="tab-content">
                            ${generateRatesTab(data)}
                        </div>
                        
                        <!-- Timestamps Tab -->
                        <div id="tab-0-timestamps" class="tab-content">
                            ${generateTimestampsTab(data)}
                        </div>
                        
                        <!-- Entities Tab -->
                        <div id="tab-0-entities" class="tab-content">
                            ${generateEntitiesTab(data)}
                        </div>
                    </div>
                    
                    <!-- Raw Data -->
                    <div class="raw-data">
                        <h3>
                            üìä Raw JSON Data
                            <button class="copy-btn" onclick="copyToClipboard('${shipmentId}')">üìã Copy</button>
                        </h3>
                        <pre id="raw-${shipmentId}">${JSON.stringify(data, null, 2)}</pre>
                    </div>
                </div>
            `;
            
            content.innerHTML = html;
        }

        // Helper functions removed - not needed with new structure

        function generateOverviewCards(data, shipmentId) {
            // Use data directly from the shipment object
            
            return `
                <div class="overview-card">
                    <h3>üì¶ Basic Information</h3>
                    <div class="info-row">
                        <div class="info-label">Shipment ID:</div>
                        <div class="info-value">${shipmentId}</div>
                    </div>
                    <div class="info-row">
                        <div class="info-label">Type:</div>
                        <div class="info-value">${data.type || 'N/A'}</div>
                    </div>
                    <div class="info-row">
                        <div class="info-label">Booking Reference:</div>
                        <div class="info-value">${data.booking_reference || 'N/A'}</div>
                    </div>
                    <div class="info-row">
                        <div class="info-label">Container Number:</div>
                        <div class="info-value">${data.container_number || 'N/A'}</div>
                    </div>
                    <div class="info-row">
                        <div class="info-label">Container Seal:</div>
                        <div class="info-value">${data.container_seal || 'None'}</div>
                    </div>
                </div>
                
                <div class="overview-card">
                    <h3>üìç Cargo Details</h3>
                    <div class="info-row">
                        <div class="info-label">Cargo:</div>
                        <div class="info-value">${data.cargo || 'N/A'}</div>
                    </div>
                    <div class="info-row">
                        <div class="info-label">Container Type:</div>
                        <div class="info-value">${data.container || 'N/A'}</div>
                    </div>
                    <div class="info-row">
                        <div class="info-label">Source:</div>
                        <div class="info-value">${data.source || 'N/A'}</div>
                    </div>
                    <div class="info-row">
                        <div class="info-label">Actual Departure:</div>
                        <div class="info-value">${formatDate(data.actual_departure)}</div>
                    </div>
                </div>
            `;
        }

        function generateTimeline(milestones) {
            if (!milestones || milestones.length === 0) {
                return '<p style="color: #7f8c8d; text-align: center;">No timeline events available</p>';
            }
            
            return milestones.slice(0, 10).map(milestone => `
                <div class="timeline-item">
                    <div class="timeline-date">${formatDate(milestone.timestamp)}</div>
                    <div class="timeline-content">
                        <div class="timeline-title">Milestone Event</div>
                        <div class="timeline-description">
                            ${milestone.event || 'Event occurred'}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function formatDate(dateString) {
            if (!dateString) return 'N/A';
            const date = new Date(dateString);
            return date.toLocaleString('en-US', {
                year: 'numeric',
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }
        
        // Tab content generators
        function generatePricingTab(data) {
            return `
                <div class="detail-section">
                    <h2>üí∞ Pricing Information</h2>
                    <div class="info-row">
                        <div class="info-label">Base Quote:</div>
                        <div class="info-value">${data.base_quote || 'N/A'}</div>
                    </div>
                    <div class="info-row">
                        <div class="info-label">Tax Rate:</div>
                        <div class="info-value">${data.tax_rate || 'N/A'}</div>
                    </div>
                    <div class="info-row">
                        <div class="info-label">Total with Tax:</div>
                        <div class="info-value">${data.total_with_tax || 'N/A'}</div>
                    </div>
                    <div class="info-row">
                        <div class="info-label">Total Price INR:</div>
                        <div class="info-value">${data.total_price_inr || 'N/A'}</div>
                    </div>
                    <div class="info-row">
                        <div class="info-label">Discounted Price:</div>
                        <div class="info-value">${data.discounted_price || 'N/A'}</div>
                    </div>
                    <div class="info-row">
                        <div class="info-label">Tax on Discounted Price:</div>
                        <div class="info-value">${data.tax_on_discounted_price || 'N/A'}</div>
                    </div>
                    <div class="info-row">
                        <div class="info-label">Advance Amount:</div>
                        <div class="info-value">${data.advance_amount || 'N/A'}</div>
                    </div>
                    ${data.alternative_prices ? `
                    <h3>Alternative Prices</h3>
                    <div style="margin: 15px 0;">
                        ${data.alternative_prices.map(price => `<span class="tag">${price}</span>`).join('')}
                    </div>` : ''}
                </div>
            `;
        }
        
        function generateProvidersTab(data) {
            return `
                <div class="detail-section">
                    <h2>üè¢ Service Providers</h2>
                    ${data.service_provider_ids ? `
                    <h3>Service Provider IDs (${data.service_provider_ids.length})</h3>
                    <div style="margin: 15px 0;">
                        ${data.service_provider_ids.map(id => `<span class="tag">${id}</span>`).join('')}
                    </div>` : '<p>No service providers listed</p>'}
                    
                    ${data.shipping_line_ids ? `
                    <h3>Shipping Line IDs (${data.shipping_line_ids.length})</h3>
                    <div style="margin: 15px 0;">
                        ${data.shipping_line_ids.map(id => `<span class="tag">${id}</span>`).join('')}
                    </div>` : ''}
                    
                    <div class="info-row">
                        <div class="info-label">Importer/Exporter ID:</div>
                        <div class="info-value">${data.importer_exporter_id || 'N/A'}</div>
                    </div>
                    <div class="info-row">
                        <div class="info-label">Consistent Service ID:</div>
                        <div class="info-value">${data.consistent_service_id || 'N/A'}</div>
                    </div>
                </div>
            `;
        }
        
        function generateGeographicTab(data) {
            return `
                <div class="detail-section">
                    <h2>üåç Geographic Information</h2>
                    <div class="info-row">
                        <div class="info-label">Origin Port ID:</div>
                        <div class="info-value">${data.origin_port_id || 'N/A'}</div>
                    </div>
                    <div class="info-row">
                        <div class="info-label">Destination Port ID:</div>
                        <div class="info-value">${data.destination_port_id || 'N/A'}</div>
                    </div>
                    <div class="info-row">
                        <div class="info-label">Origin Country ID:</div>
                        <div class="info-value">${data.origin_country_id || 'N/A'}</div>
                    </div>
                    <div class="info-row">
                        <div class="info-label">Destination Country ID:</div>
                        <div class="info-value">${data.destination_country_id || 'N/A'}</div>
                    </div>
                    <div class="info-row">
                        <div class="info-label">Cargo Stuffing Location:</div>
                        <div class="info-value">${data.cargo_stuffing_location || 'N/A'}</div>
                    </div>
                    <div class="info-row">
                        <div class="info-label">Origin Trade ID:</div>
                        <div class="info-value">${data.origin_trade_id || 'N/A'}</div>
                    </div>
                    <div class="info-row">
                        <div class="info-label">Destination Trade ID:</div>
                        <div class="info-value">${data.destination_trade_id || 'N/A'}</div>
                    </div>
                </div>
            `;
        }
        
        function generateDocumentsTab(data) {
            return `
                <div class="detail-section">
                    <h2>üìÑ Documents</h2>
                    ${data.documents && data.documents.length > 0 ? data.documents.map(doc => `
                    <div class="document-item" style="background: #f5f5f5; padding: 15px; margin: 10px 0; border-radius: 5px; display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <strong>${doc.type || 'Document'}</strong><br>
                            <small style="color: #7f8c8d;">Uploaded: ${formatDate(doc.uploaded_at)}</small><br>
                            <small>${doc.file_name || 'Unnamed file'}</small>
                        </div>
                        ${doc.url ? `
                        <button class="nav-btn" style="padding: 8px 16px; font-size: 13px;" onclick="window.open('${doc.url}', '_blank')">
                            üìÑ View Document
                        </button>` : ''}
                    </div>`).join('') : '<p>No documents uploaded</p>'}
                    
                    ${data.document_urls ? `
                    <h3>Document URLs</h3>
                    ${Object.entries(data.document_urls).map(([key, url]) => `
                    <div class="info-row" style="display: flex; align-items: center; justify-content: space-between;">
                        <div style="flex: 1;">
                            <div class="info-label">${key}:</div>
                            <div class="info-value" style="word-break: break-all;">${url}</div>
                        </div>
                        <button class="nav-btn" style="padding: 8px 16px; font-size: 13px; margin-left: 10px; flex-shrink: 0;" onclick="window.open('${url}', '_blank')">
                            üìÑ View
                        </button>
                    </div>`).join('')}` : ''}
                </div>
            `;
        }
        
        function generateFinancialTab(data) {
            return `
                <div class="detail-section">
                    <h2>üíµ Financial Details</h2>
                    <div class="info-row">
                        <div class="info-label">Payment Terms:</div>
                        <div class="info-value">${data.payment_terms || 'N/A'}</div>
                    </div>
                    <div class="info-row">
                        <div class="info-label">Product Code:</div>
                        <div class="info-value">${data.product_code || 'N/A'}</div>
                    </div>
                    ${data.exchange_rates ? `
                    <h3>Exchange Rates</h3>
                    <div style="margin: 15px 0;">
                        ${data.exchange_rates.map(rate => `<span class="tag">${rate}</span>`).join('')}
                    </div>` : ''}
                    ${data.margin_structure ? `
                    <h3>Margin Structure</h3>
                    <div class="info-row">
                        <div class="info-label">Cogoport Margin:</div>
                        <div class="info-value">${data.margin_structure.cogoport_margin || 'N/A'}</div>
                    </div>
                    <div class="info-row">
                        <div class="info-label">Demand Adjustment:</div>
                        <div class="info-value">${data.margin_structure.demand_adjustment || 'N/A'}</div>
                    </div>` : ''}
                </div>
            `;
        }
        
        function generateSystemTab(data) {
            return `
                <div class="detail-section">
                    <h2>üîß System Information</h2>
                    <div class="info-row">
                        <div class="info-label">Shipment Serial ID:</div>
                        <div class="info-value">${data.shipment_serial_id || 'N/A'}</div>
                    </div>
                    <div class="info-row">
                        <div class="info-label">Activity Period Start:</div>
                        <div class="info-value">${formatDate(data.activity_period_start)}</div>
                    </div>
                    <div class="info-row">
                        <div class="info-label">Activity Period End:</div>
                        <div class="info-value">${formatDate(data.activity_period_end)}</div>
                    </div>
                    <div class="info-row">
                        <div class="info-label">Data Source:</div>
                        <div class="info-value">${data.data_source?.join(', ') || 'N/A'}</div>
                    </div>
                    <div class="info-row">
                        <div class="info-label">Change Actors:</div>
                        <div class="info-value">${data.change_actors?.join(', ') || 'N/A'}</div>
                    </div>
                    <div class="info-row">
                        <div class="info-label">Platform:</div>
                        <div class="info-value">${data.platform || 'N/A'}</div>
                    </div>
                    ${data.platforms_used ? `
                    <h3>Platforms Used</h3>
                    <div style="margin: 15px 0;">
                        ${data.platforms_used.map(platform => `<span class="tag">${platform}</span>`).join('')}
                    </div>` : ''}
                </div>
            `;
        }
        
        function generateRatesTab(data) {
            return `
                <div class="detail-section">
                    <h2>üìä Rate History</h2>
                    ${data.rate_history && data.rate_history.length > 0 ? `
                    <table class="rate-table" style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background: #f8f9fa;">
                                <th style="padding: 12px; text-align: left; border: 1px solid #ddd;">Timestamp</th>
                                <th style="padding: 12px; text-align: left; border: 1px solid #ddd;">Price</th>
                                <th style="padding: 12px; text-align: left; border: 1px solid #ddd;">Currency</th>
                                <th style="padding: 12px; text-align: left; border: 1px solid #ddd;">Tax %</th>
                                <th style="padding: 12px; text-align: left; border: 1px solid #ddd;">Total</th>
                                <th style="padding: 12px; text-align: left; border: 1px solid #ddd;">Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${data.rate_history.map(rate => `
                            <tr>
                                <td style="padding: 12px; border: 1px solid #ddd;">${formatDate(rate.timestamp)}</td>
                                <td style="padding: 12px; border: 1px solid #ddd;">${rate.price}</td>
                                <td style="padding: 12px; border: 1px solid #ddd;">${rate.currency}</td>
                                <td style="padding: 12px; border: 1px solid #ddd;">${rate.tax_percent}%</td>
                                <td style="padding: 12px; border: 1px solid #ddd;">${rate.tax_total_price}</td>
                                <td style="padding: 12px; border: 1px solid #ddd;">
                                    ${rate.is_reverted ? 
                                    `<span style="color: #e74c3c;">Reverted</span>` : 
                                    `<span style="color: #27ae60;">Active</span>`}
                                </td>
                            </tr>`).join('')}
                        </tbody>
                    </table>` : '<p>No rate history available</p>'}
                </div>
            `;
        }
        
        function generateTimestampsTab(data) {
            return `
                <div class="detail-section">
                    <h2>‚è∞ All Timestamps</h2>
                    <div class="info-row">
                        <div class="info-label">Cargo Readiness Date:</div>
                        <div class="info-value">${formatDate(data.cargo_readiness_date)}</div>
                    </div>
                    <div class="info-row">
                        <div class="info-label">Scheduled Departure:</div>
                        <div class="info-value">${formatDate(data.scheduled_departure)}</div>
                    </div>
                    <div class="info-row">
                        <div class="info-label">SI Filed:</div>
                        <div class="info-value">${formatDate(data.si_filed)}</div>
                    </div>
                    <div class="info-row">
                        <div class="info-label">Origin Customs Cleared:</div>
                        <div class="info-value">${formatDate(data.origin_customs_cleared)}</div>
                    </div>
                    <div class="info-row">
                        <div class="info-label">Container Picked from Yard:</div>
                        <div class="info-value">${formatDate(data.container_picked_from_yard)}</div>
                    </div>
                    <div class="info-row">
                        <div class="info-label">Container Gated In:</div>
                        <div class="info-value">${formatDate(data.container_gated_in)}</div>
                    </div>
                    ${data.rate_expiration_times ? `
                    <h3>Rate Expiration Times</h3>
                    <div style="margin: 15px 0; word-break: break-all;">
                        ${data.rate_expiration_times.join(', ')}
                    </div>` : ''}
                    ${data.rate_validity_periods ? `
                    <h3>Rate Validity Periods</h3>
                    <div style="margin: 15px 0; word-break: break-all;">
                        ${data.rate_validity_periods.join(', ')}
                    </div>` : ''}
                </div>
            `;
        }
        
        function generateEntitiesTab(data) {
            return `
                <div class="detail-section">
                    <h2>üîç Entity Information</h2>
                    ${data.entity_types ? `
                    <h3>Entity Types</h3>
                    <table class="rate-table" style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background: #f8f9fa;">
                                <th style="padding: 12px; text-align: left; border: 1px solid #ddd;">Entity Type</th>
                                <th style="padding: 12px; text-align: left; border: 1px solid #ddd;">Count</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${Object.entries(data.entity_types).map(([type, count]) => `
                            <tr>
                                <td style="padding: 12px; border: 1px solid #ddd;">${type}</td>
                                <td style="padding: 12px; border: 1px solid #ddd;">${count}</td>
                            </tr>`).join('')}
                        </tbody>
                    </table>` : ''}
                    
                    ${data.entity_ids ? `
                    <h3>All Entity IDs (${data.entity_ids.length} total)</h3>
                    <div style="margin: 15px 0;">
                        ${data.entity_ids.map(id => `<span class="tag">${id}</span>`).join('')}
                    </div>` : ''}
                    
                    ${data.user_ids ? `
                    <h3>User IDs</h3>
                    <div style="margin: 15px 0;">
                        ${data.user_ids.map(id => `<span class="tag">${id}</span>`).join('')}
                    </div>` : ''}
                    
                    ${data.pending_task_ids ? `
                    <h3>Pending Task IDs</h3>
                    <div style="margin: 15px 0;">
                        ${data.pending_task_ids.map(id => `<span class="tag">${id}</span>`).join('')}
                    </div>` : ''}
                    
                    ${data.null_fields ? `
                    <h3>Fields with Null Values</h3>
                    <div style="margin: 15px 0;">
                        ${data.null_fields.map(field => `<span class="tag" style="background: #ffebee; color: #c62828;">${field}</span>`).join('')}
                    </div>` : ''}
                </div>
            `;
        }

        function copyToClipboard(shipmentId) {
            const text = document.getElementById(`raw-${shipmentId}`).textContent;
            navigator.clipboard.writeText(text).then(() => {
                const btn = event.target;
                btn.textContent = '‚úÖ Copied!';
                btn.classList.add('copied');
                setTimeout(() => {
                    btn.textContent = 'üìã Copy';
                    btn.classList.remove('copied');
                }, 2000);
            });
        }

        function showError(message) {
            document.getElementById('content').innerHTML = 
                `<div class="error">‚ùå ${message}</div>`;
        }
        
        // Show specific tab
        function showTab(shipmentIndex, tabName) {
            // Hide all tabs for this shipment
            const allTabs = document.querySelectorAll(`#shipment-${shipmentIndex} .tab-content`);
            allTabs.forEach(tab => tab.classList.remove('active'));
            
            // Show selected tab
            const selectedTab = document.getElementById(`tab-${shipmentIndex}-${tabName}`);
            if (selectedTab) {
                selectedTab.classList.add('active');
            }
            
            // Update button states
            const allButtons = document.querySelectorAll(`#shipment-${shipmentIndex} .tab-btn`);
            allButtons.forEach(btn => btn.classList.remove('active'));
            
            // Set active button
            event.target.classList.add('active');
        }

        // Handle Enter key in search
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('searchInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') searchShipment();
            });
            
            // Start loading data
            loadDataIndex();
        });
    </script>
</body>
</html>